# twitter-clone-go

Go を用いた TwitterAPI です

## 仕様 ① セットアップ

#### 仕様

```txt
setup
docker,docker-composeを使用してginが立ち上がるところまでセットアップする
この段階ではpostgresは導入しなくてよい
完了条件:
http://localhost:8080/health_check で"{status: ok}"のjsonが返るようにする。
```

## 仕様 ② サインアップ

```txt
- サインアップ機能を実装する
- メールアドレスとパスワードでサインアップできるようにする
- メールアドレスはユニーク
- メールアドレスはフォーマットのチェックを行うこと
- パスワードは 8 文字以上を満たすこと
    - 半角英数字が含まれる（英字だけは x,数字だけも x)
    - 英字は小文字大文字混合(小文字だけは x)
    - 以下の記号が 1 文字以上含まれる
        - !?-\_
- パスワードはハッシュ化して保存すること
```

## 仕様 ③ ユーザアクティベーション機能

```txt
ユーザーアクティベーション機能
サインアップ後に確認メールを送信するようにする
確認メール内にアクティベーション用のリンクを埋め込む
リンクにはユーザーを特定するtokenを埋め込む
リンクにアクセスがあった場合はユーザーをアクティブ状態にする
メールの確認はmailcatcherを用いること
他にdockerで簡易に導入できるメールサーバーがあれば使用してよいものとする
ユーザーは確認メールのリンクを踏まない限り、active状態にならずログインできないようにする
```

## 仕様 ④ ログイン機能の実装
```txt
ユーザーのログイン機能を実装する
メールアドレスとパスワードでログインする
認証に失敗した場合はステータスコード401を返し、わかりやすいエラーメッセージを返す
確認メールを確認しておらずactive状態になっていなければステータスコード401とともにわかりやすいエラーメッセージを返す
sessionはredisに保存し、keyは一意な値(uuidがよいでしょう）、valueはユーザーのidのみ保存する
redisはdocker-composeで起動できるようにすること
sessionはset-cookie headerでレスポンスすること
```

## 仕様 ⑤ twitter投稿API
```
ツイートを投稿できるようにする
ツイートは140文字以内の制限を設けること
ログインしている場合のみツイートできるようにする
レスポンスはユーザーIDとツイート本文を返すこと
```

## 仕様 ⑤ twitter一覧API
```txt
ツイートの一覧を取得できるようにする
ページネーションができるかつ、ページネーションをフロントエンドで表示できるようにレスポンスを返すこと
```
#### サブタスク（PR が 500 行以上なら分割予定）

- ✅ postgres コンテナ起動
- ✅ DB 初期化 init.sql
- ✅ go コンテナと連携
- ✅ コントローラ分割
- ✅ email と password のバリデーション

↑ のリファクタリングは「signup-validation」ブランチで実装

⇩ は「signup-残り」のブランチで実装。

- ✅ sqlc のセットアップ
- ✅ パスワードはハッシュ化してユーザ保存（signup 機能）
- ✅ ルーター分割
- ✅ リポジトリ分割
- ✅main ファイルに DB のセットアップ書いてるのやだ
- ✅ エラーハンドリング
- hash 化関数のヘルパー化
- init.sql と schema.sql(sqlc)で何か二重管理してる?
- ✅ 認証メール用トークンを DB に保存
- ✅ 自動フォーマット切りっぱなしかも。つけよう。
- ✅ アクティブフラグを true に変更後、認証一時テーブルの該当レコードを削除する
- expire の期限が来たらどうする？バッチ処理で expire_at カラムを過ぎているレコードを削除
- サインアップ時にメール正常に送って、から認証一時情報テーブルに保存するってのは両方成功したらコミットしてどちらか失敗したら全部なしにしたい
- docker compose ファイルのマルチステージビルド
- ✅servicers ディレクトリに業務ロジックを移譲（ハンドラーが返すレスポンスを整形する）
- ✅ サービスクラスからのエラーがいく種類かあるのでそのエラーごとの http ステータス返却を仕分けたい。
- ✅ メール送信処理を分離させたい
- ✅ middleware を学ぶ
- gin.logger とは
- ✅ pgtype.Timestamp と time.Time
- ✅ エラーログ、code だけ返すか、code とエラーメッセージも返すのか
- ✅\*と&
- ✅ レスポンスデータでエラーメッセージとエラーメッセージのコードを返す
- 一つのファイルに 1 つのデータベースの変数を割り当てて使い回す
- interface
- 1 機能ごとに記事を書く
- デバック

- context
- transaction
- context.Context
- transaction の client
